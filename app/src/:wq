import Vue from 'vue'
import Vuex from 'vuex'
import axios from 'axios'
import cors from 'cors'

Vue.use(Vuex)

const API_URL = '127.0.0.1:3000'
axios.defaults.headers.post['Content-Type'] = 'application/json'
axios.defaults.headers.post['Access-Control-Allow-Origin'] = API_URL

export default new Vuex.Store({
  state: {
    posts: [{username: 'kkiriyama', text: '本日は晴天なり'}]
  },
  mutations: {
    setTimeline (state, payload) {
      state.posts = payload.data
    }
  },
  actions: {
    async getTimeline () {
      const data = await axios.get(API_URL + '/timeline', cors())
        .catch(e => console.error(e))
      this.commit('setTimeline', {data: data})
    }
  }
})
